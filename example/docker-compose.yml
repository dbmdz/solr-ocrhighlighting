version: '2'
services:
  solr:
    command: solr-foreground -a "-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=1044"
    build: solr
    ports:
      - "1044:1044"  # Debugging port
      - "8983:8983"  # Solr admin interface
    volumes:
      - ..:/opt/solr-plugin
      - data-lunion:/opt/solr/server/solr/bnl_lunion/data
      - data-google1000:/opt/solr/server/solr/google1000/data
      - ./data:/data

  iiif-prezi:
    command: pipenv run prod
    build: iiif-prezi
    volumes:
      - ./data:/data
    environment:
      - CFG_SOLR_BASE=http://solr:8983/solr
      - CFG_SERVER_NAME=localhost:8181
      - CFG_IMAGE_API_BASE=https://ocrhl.jbaiter.de/iiif/image/v2
      - CFG_GOOGLE1000_PATH=/data/google1000
      - CFG_BNL_PATH=/data/bnl_lunion
      - CFG_APP_PATH=/iiif/presentation

  frontend:
    build: frontend
    ports:
      - "8181:80"

volumes:
  data-lunion:
  data-google1000:
